<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <changeSet id="oic-eug-1" logicalFilePath="path-independent" author="eugene">
        <comment>Creating schema</comment>
        <sql dbms="postgresql" endDelimiter=";">
            create schema apps
        </sql>

        <rollback>
            <sql dbms="postgresql" endDelimiter=";">
                drop schema apps
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="oic-eug-2" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: log_points</comment>
        <createTable tableName="log_points" schemaName="apps" remarks="Справочник логических точек ОИК">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Наименование точки">
                <constraints nullable="false"/>
            </column>

            <column name="last_load_time" type="timestamp" remarks="Дата и время последней загрузки данных">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="oic-eug-3" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: log_points</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_log_points"
                schemaName="apps"
                tableName="log_points"/>
    </changeSet>


    <changeSet id="oic-eug-4" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: telemetry</comment>
        <createTable tableName="telemetry" schemaName="apps" remarks="Данные телеизмерений">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="date_time" type="timestamp" remarks="Дата и время телеизмерения">
                <constraints nullable="false"/>
            </column>

            <column name="log_point_id" type="number" remarks="Идентификатор точки">
                <constraints nullable="false"/>
            </column>

            <column name="val" type="number" remarks="Телеизмерение">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="oic-eug-5" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: telemetry</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_telemetry"
                schemaName="apps"
                tableName="telemetry"/>
    </changeSet>

    <changeSet id="oic-eug-6" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: telemetry</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="telemetry_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="media-eug-7" logicalFilePath="path-independent" author="eugene">
        <comment>Adding column system_code into table: telemetry</comment>
        <addColumn schemaName="apps" tableName="telemetry">
            <column name="system_code" type="varchar(20)" remarks="Система - источник данных" defaultValue="OIC">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="oic-eug-8" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: arc_types</comment>
        <createTable tableName="arc_types" schemaName="apps" remarks="Типы архивов">
            <column name="code" type="varchar(10)" remarks="Код типа архива">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Наименование типа архива">
                <constraints nullable="false"/>
            </column>

            <column name="step" type="number" remarks="Шаг (сек)">
                <constraints nullable="false"/>
            </column>

            <column name="last_load_time" type="timestamp" remarks="Дата и время последней загрузки данных">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="oic-eug-9" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: arc_types</comment>
        <addPrimaryKey
                schemaName="apps"
                columnNames="code"
                constraintName="pk_arc_types"
                tableName="arc_types"/>
    </changeSet>

    <changeSet id="media-eug-10" logicalFilePath="path-independent" author="eugene">
        <comment>Adding column arc_type_code into table: telemetry</comment>
        <addColumn schemaName="apps" tableName="telemetry">
            <column name="arc_type_code" type="varchar(10)" remarks="Код типа архива" defaultValue="MIN-3">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="media-eug-11" logicalFilePath="path-independent" author="eugene">
        <comment>Adding column is_active into table: arc_types</comment>
        <addColumn schemaName="apps" tableName="arc_types">
            <column name="is_active" type="number" remarks="Активно/неактивно" defaultValue="1">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="media-eug-12" logicalFilePath="path-independent" author="eugene">
        <comment>Inserting records into table: arc_types</comment>
        <insert schemaName="apps" tableName="arc_types">
            <column name="code" type="varchar(30)" value="MIN-60" />
            <column name="name" type="varchar(100)" value="Часовый архив телеизмерений" />
            <column name="step" type="number" value="3600" />
            <column name="is_active" type="number" value="1" />
        </insert>

        <rollback/>
    </changeSet>

    <changeSet id="media-eug-13" logicalFilePath="path-independent" author="eugene">
        <comment>Adding column oic_arc_id into table: arc_types</comment>
        <addColumn schemaName="apps" tableName="arc_types">
            <column name="oic_arc_id" type="number" remarks="Активно/неактивно" defaultValue="1">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>


    <changeSet id="oic-eug-14" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: missing_telemetry</comment>
        <createTable tableName="missing_telemetry" schemaName="apps" remarks="Отсутствующие срезы телеизмерений">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="system_code" type="varchar(20)" remarks="Система - источник данных" defaultValue="OIC">
                <constraints nullable="false"/>
            </column>

            <column name="arc_type_code" type="varchar(10)" remarks="Код типа архива" defaultValue="MIN-3">
                <constraints nullable="false"/>
            </column>

            <column name="date_time" type="timestamp" remarks="Дата и время телеизмерения">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="oic-eug-15" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: missing_telemetry</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_missing_telemetry"
                schemaName="apps"
                tableName="missing_telemetry"/>
    </changeSet>

    <changeSet id="oic-eug-16" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: missing_telemetry</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="missing_telemetry_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="media-eug-17" logicalFilePath="path-independent" author="eugene">
        <comment>Adding column is_new_point into table: log_points</comment>
        <addColumn schemaName="apps" tableName="log_points">
            <column name="is_new_point" type="number" remarks="Новая точка">
                <constraints nullable="true"/>
            </column>
            <column name="start_time" type="timestamp" remarks="Дата и время начала импорта">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="media-eug-18" logicalFilePath="path-independent" author="eugene">
        <comment>Adding column is_active into table: log_points</comment>
        <addColumn schemaName="apps" tableName="log_points">
            <column name="is_active" type="number" remarks="Точка учёта аактивна" defaultValue="0">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

</databaseChangeLog>
